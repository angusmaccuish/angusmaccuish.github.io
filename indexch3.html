<!DOCTYPE html> 
<html lang='en-US' xml:lang='en-US'> 
<head><title>3 Inter-Bucket Aggregation</title> 
<meta charset='utf-8' /> 
<meta content='TeX4ht (https://tug.org/tex4ht/)' name='generator' /> 
<meta content='width=device-width,initial-scale=1' name='viewport' /> 
<link href='index.css' rel='stylesheet' type='text/css' /> 
<meta content='index.tex' name='src' /> 
<script>window.MathJax = { tex: { tags: "ams", }, }; </script> 
 <script async='async' id='MathJax-script' src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js' type='text/javascript'></script>  
</head><body>
<!-- l. 1 --><div class='crosslinks'><p class='noindent'>[<a href='indexch4.html'>next</a>] [<a href='indexch2.html'>prev</a>] [<a href='indexch2.html#tailindexch2.html'>prev-tail</a>] [<a href='#tailindexch3.html'>tail</a>] [<a href='index.html#indexch3.html'>up</a>] </p></div>
<h2 class='chapterHead'><span class='titlemark'>Chapter 3</span><br /><a id='x7-90003'></a>Inter-Bucket Aggregation</h2>
<h3 class='sectionHead'><span class='titlemark'>3.1   </span> <a id='x7-100003.1'></a>Overview</h3>
<!-- l. 5 --><p class='noindent'>Unlike the intra-bucket case, where the calculation was always dependent on the number of
underlyings in the portfolio, the inter-bucket correlation is typically based on a small, fixed
number of <span class='cmti-10x-x-109'>buckets</span>. As before, curvature has an additional subtlety, which is once
again in the form of a \(\psi \) function which suppresses correlations between negative
quantities.
</p><!-- l. 10 --><p class='noindent'>
</p>
<h3 class='sectionHead'><span class='titlemark'>3.2   </span> <a id='x7-110003.2'></a>Delta/Vega</h3>
<!-- l. 12 --><p class='noindent'>The delta/vega capital charge \(K\) for a given risk class is determined using the following:
</p><!-- l. 16 --><p class='noindent'>\begin {equation}  K^2 = \sum _b K_b^2 + \sum _{\substack {b,c \\ c \ne b}} \gamma _{bc} \: S_b \: S_c  \end {equation}<a id='x7-11001r1'></a>
</p><!-- l. 18 --><p class='noindent'>where
</p>
     <ul class='itemize1'>
     <li class='itemize'>\(K_b\) is the risk position of bucket \(b\)
     </li>
     <li class='itemize'>\(S_b = \sum _k w_k\) where \(\textbf {w}\) is the weighted sensitivity vector associated with bucket \(b\)
     </li>
     <li class='itemize'>\(\gamma _{bc}\) is the (inter-bucket) correlation between buckets \(b\) and \(c\)</li></ul>
<!-- l. 26 --><p class='noindent'>This formula can return negative values, in which case an alternative definition for \(S_b\) must be
used instead:
</p><!-- l. 30 --><p class='noindent'>\begin {equation}  S_b = \mathrm {max} \left ( \mathrm {min} \left ( \sum _k w_k, K_b \right ), -K_b \right )  \end {equation}<a id='x7-11002r2'></a>
                                                                                

                                                                                
</p><!-- l. 32 --><p class='noindent'>In contrast to the intra-bucket case, the two terms in the \(K^2\) formula relate to two different
quantities, \(K_b\) and \(S_b\), as opposed to just \(w_k\) in the former. For the intra-bucket case, it suited us to
define \(\rho _{kl} = 1\) for \(k=l\) (the diagonal terms), allowing the first term to be absorbed into the resulting
matrix formula. For the inter-bucket correlation, it will benefit us to define \(\gamma _{bc} = 0\) if \(b = c\), which means
we can drop the restriction \(c \ne b\) in the double summation (since the \(b = c\) contribution is
zero):
</p><!-- l. 44 --><p class='noindent'>\begin {equation}  \begin {aligned} K^2 &amp;= \sum _b K_b^2 + \sum _{\substack {b,c \\ c \ne b}} \gamma _{bc} \: S_b \: S_c \\ &amp;= \sum _b K_b^2 + \sum _{b,c} \gamma _{bc} \: S_b \: S_c \\ &amp;= \sum _b K_b^2 + \textbf {S} \: C \: \textbf {S}^T \end {aligned}  \end {equation}<a id='x7-11003r3'></a>
</p><!-- l. 46 --><p class='noindent'>where \(\textbf {S}\) is the vector of \(S_b\) values, and \(C\) is the inter-bucket correlation matrix (with zeros on the
diagonal). All that remains is to take the square root in order to obtain the delta/vega capital
risk charge, \(K\).
</p><!-- l. 49 --><p class='noindent'>For a daily risk charge calculation, the above provides a single value per delta/vega risk class
for a given scenario (low/medium/high). Once values have been computed for all
three scenarios, the results can be fed into the overall portfolio calculation. If, as
discussed in the intra-bucket case, we need to determine \(K\) at lower levels, for example
per desk or per book, we can once again compute <span class='cmti-10x-x-109'>all </span>these values in one single
calculation.
</p><!-- l. 54 --><p class='noindent'>Consider the matrix \(S\) which is constructed by stacking the \(\textbf {S}\) row-vectors, one per group (where
the ‘group’ once again refers to the aggregation level we require, eg group \(G_1\) may refer to Book \(1\),
\(G_2\) to Book \(2\), etc).
</p><!-- l. 64 --><p class='noindent'>\begin {equation}  S = \begin {bmatrix} \textbf {S}_{G_1} \\ \textbf {S}_{G_2} \\ \vdots \\ \textbf {S}_{G_n} \end {bmatrix}  \end {equation}<a id='x7-11004r4'></a>
</p><!-- l. 66 --><p class='noindent'>Now, instead of computing \(\textbf {S}_{G_i} \: C \: \textbf {S}_{G_i}^T\) for each group \(G_i\), we compute \(S \: C \: S^T\) and read the values on the diagonal
to determine contribution to each capital charge. For example, for group \(G_i\) with \(i=1,2, .., N_G\) where \(N_G\) is
the number of groups, we read off the \(i^{th}\) value on the diagonal. The \(\sum _b K_b^2\) contribution is
trivially aggregated at the same level, where we can add the results together to find
\(K_{G_i}^2\).
</p><!-- l. 71 --><p class='noindent'>
</p>
<h3 class='sectionHead'><span class='titlemark'>3.3   </span> <a id='x7-120003.3'></a>Curvature</h3>
<!-- l. 73 --><p class='noindent'>Define \(K_b = \mathrm {max}(K_b^+,K_b^-)\), where \(K_b^+\) and \(K_b^-\) are the bucket \(b\) risk positions for the ‘up’ and ‘down’ scenarios. Namely,
the intra-bucket risk correlations derived using the shock vectors \(\textbf {CVR}^+\) and \(\textbf {CVR}^-\) associated with bucket
\(b\), respectively.
</p><!-- l. 77 --><p class='noindent'>Define \(S_b = \sum _k w_k\), where
</p><!-- l. 84 --><p class='noindent'>\begin {equation}  \textbf {w} = \begin {cases} \textbf {CVR}^+ &amp; K_b = K_b^+ \\ \textbf {CVR}^- &amp; K_b = K_b^- \\ \end {cases}  \end {equation}<a id='x7-12001r5'></a>
</p><!-- l. 86 --><p class='noindent'>In the terminology of the Basel documentation, we say that either the ‘up’ or the ‘down’
scenario has been <span class='cmti-10x-x-109'>selected </span>for bucket \(b\). From the FRTB specification, where \(\gamma _{bc}\) is the
                                                                                

                                                                                
(inter-bucket) correlation between buckets \(b\) and \(c\):
</p><!-- l. 92 --><p class='noindent'>\begin {equation}  K^2 = \mathrm {max} \left ( \sum _b K_b^2 + \sum _{\substack {b,c \\ c \ne b}} \gamma _{bc} \: S_b \: S_c \: \psi (S_b, S_c), \: 0 \right )  \end {equation}<a id='x7-12002r6'></a>
</p><!-- l. 94 --><p class='noindent'>where
</p><!-- l. 101 --><p class='noindent'>\begin {equation}  \psi (S_b, S_c) = \begin {cases} 0 &amp; S_b &lt; 0 \: \text {and} \: S_c &lt; 0 \\ 1 &amp; \text {otherwise} \end {cases}  \end {equation}<a id='x7-12003r7'></a>
</p><!-- l. 103 --><p class='noindent'>As before, we can drop the \(\psi \) function from the sum as long as we compensate for this by
subtracting the \(S^{(-)}\) contributions. Recalling that the diagonal \(\gamma \) are zero:
</p><!-- l. 113 --><p class='noindent'>\begin {equation}  \begin {aligned} K^2 &amp;= \sum _b K_b^2 + \sum _{\substack {b,c \\ c \ne b}} \gamma _{bc} \: S_b \: S_c \: \psi (S_b, S_c) \\ &amp;= \sum _b K_b^2 + \sum _{b,c} \gamma _{bc} \: S_b \: S_c \: \psi (S_b, S_c) \\ &amp;= \sum _b K_b^2 + \sum _{b,c} \gamma _{bc} \: S_b \: S_c - \sum _{b,c} \gamma _{bc} \: S_b^{(-)} \: S_c^{(-)} \\ &amp;= \sum _b K_b^2 + \textbf {S} \: C \: \textbf {S}^T - \textbf {S}^{(-)} \: C \: \textbf {S}^{(-)T} \end {aligned}  \end {equation}<a id='x7-12004r8'></a>
</p><!-- l. 115 --><p class='noindent'>where \(S_k^{(-)} = \mathrm {min}(S_k, 0)\) and \(C\) is the inter-bucket correlation matrix (with zeros on the diagonal). Notice that
once again we have dropped the \(\mathrm {max}\) function which floors the result at zero, with the
understanding that this step is implicit when it comes to taking the square root to determine
the curvature capital charge, \(K\).
</p><!-- l. 120 --><p class='noindent'>We are left with four simple steps:
</p><!-- l. 123 --><p class='noindent'>
     </p><dl class='enumerate'><dt class='enumerate'>
   1. </dt><dd class='enumerate'>Compute \(\sum _b K_b^2\)
     </dd><dt class='enumerate'>
   2. </dt><dd class='enumerate'>Add \(\textbf {S} \: C \: \textbf {S}^T\)
     </dd><dt class='enumerate'>
   3. </dt><dd class='enumerate'>Subtract \(\textbf {S}^{(-)} \: C \: \textbf {S}^{(-)T}\), where the vector \(\textbf {S}^{(-)}\) contains all the negative \(S_b\) (with any other entries set
     to zero).
     </dd><dt class='enumerate'>
   4. </dt><dd class='enumerate'>Floor the result at zero before taking the square root to obtain the curvature
     capital charge, \(K\).</dd></dl>
<!-- l. 130 --><p class='noindent'>To calculate the curvature risk charge at lower levels, for example book or desk, just follow the
same procedure as we did for delta/vega above.
                                                                                

                                                                                
                                                                                

                                                                                
                                                                                

                                                                                
                                                                                

                                                                                
</p>
<!-- l. 1 --><div class='crosslinks'><p class='noindent'>[<a href='indexch4.html'>next</a>] [<a href='indexch2.html'>prev</a>] [<a href='indexch2.html#tailindexch2.html'>prev-tail</a>] [<a href='indexch3.html'>front</a>] [<a href='index.html#indexch3.html'>up</a>] </p></div>
<!-- l. 1 --><p class='noindent'><a id='tailindexch3.html'></a> </p> 
</body> 
</html>